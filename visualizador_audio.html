<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Audio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a1a;
            color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            background-color: #2a2a2a;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
            text-align: center;
            width: 100%;
            max-width: 600px;
        }
        canvas {
            width: 100%;
            height: 200px;
            border-radius: 8px;
            background-color: #000000;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
        }
        input[type="file"] {
            display: none;
        }
        .custom-file-upload {
            border: 2px solid #6366f1;
            color: #6366f1;
            background-color: transparent;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            border-radius: 9999px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .custom-file-upload:hover {
            background-color: #6366f1;
            color: #ffffff;
        }
    </style>
</head>
<body>

<div class="container">
    <h1 class="text-3xl font-bold mb-2">Visualizador de Onda</h1>
    <p class="text-gray-400 mb-6">Sube tu archivo de audio para ver la visualizaci√≥n en tiempo real.</p>
    
    <label for="audioFile" class="custom-file-upload">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path d="M5.555 17.555h8.89a.5.5 0 00.5-.5v-4.5a.5.5 0 00-.5-.5h-8.89a.5.5 0 00-.5.5v4.5a.5.5 0 00.5.5zM4 11a1 1 0 011-1h10a1 1 0 011 1v5a1 1 0 01-1 1H5a1 1 0 01-1-1v-5z" />
            <path d="M10 2a.5.5 0 01.5.5v7.793l1.854-1.854a.5.5 0 11.708.708l-2.75 2.75a.5.5 0 01-.708 0l-2.75-2.75a.5.5 0 11.708-.708L9.5 10.293V2.5a.5.5 0 01.5-.5z" />
        </svg>
        Seleccionar Archivo
    </label>
    <input type="file" id="audioFile" accept="audio/*">
    
    <canvas id="visualizerCanvas"></canvas>

    <audio id="audioPlayer" controls class="w-full mt-4"></audio>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const audioPlayer = document.getElementById('audioPlayer');
        const fileInput = document.getElementById('audioFile');
        const canvas = document.getElementById('visualizerCanvas');
        const canvasCtx = canvas.getContext('2d');
        let audioCtx;
        let analyser;
        let source;
        let dataArray;
        let bufferLength;

        // Load the audio file selected by the user
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                audioPlayer.src = url;
                audioPlayer.load();
                audioPlayer.play();
                
                // Initialize the audio context and analyser
                if (!audioCtx) {
                    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                }

                // Disconnect any existing source node
                if (source) {
                    source.disconnect();
                }

                source = audioCtx.createMediaElementSource(audioPlayer);
                analyser = audioCtx.createAnalyser();
                analyser.fftSize = 256;
                bufferLength = analyser.frequencyBinCount;
                dataArray = new Uint8Array(bufferLength);
                
                source.connect(analyser);
                analyser.connect(audioCtx.destination);
                
                draw();
            }
        });

        // Function to draw the waveform
        function draw() {
            requestAnimationFrame(draw);
            analyser.getByteTimeDomainData(dataArray);

            canvasCtx.fillStyle = '#1a1a1a';
            canvasCtx.fillRect(0, 0, canvas.width, canvas.height);

            canvasCtx.lineWidth = 2;
            canvasCtx.strokeStyle = '#6366f1';
            canvasCtx.beginPath();

            const sliceWidth = canvas.width * 1.0 / bufferLength;
            let x = 0;

            for (let i = 0; i < bufferLength; i++) {
                const v = dataArray[i] / 128.0;
                const y = v * canvas.height / 2;

                if (i === 0) {
                    canvasCtx.moveTo(x, y);
                } else {
                    canvasCtx.lineTo(x, y);
                }

                x += sliceWidth;
            }

            canvasCtx.lineTo(canvas.width, canvas.height / 2);
            canvasCtx.stroke();
        }
    });
</script>

</body>
</html>
